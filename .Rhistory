library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat)
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat)
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat)
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
library(GuttmanHeatmap)
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat)
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat,colsplitx = annotx$Treatment)
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat,colsplitx = annotx$Treatment)
load('~/Downloads/testmat.RData')
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
ls()
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
library(GuttmanHeatmap)
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=10,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=20,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
library(GuttmanHeatmap)
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=20,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=20,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=20,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=20,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
library(GuttmanHeatmap)
load('~/Downloads/testmat.RData')
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=20,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=coefs,fdx=fdrs)
doAnnotatedHeatmap(grafname='test.pdf',annot.col = annotx,wdt=20,hgt=10,matx=mat,colsplitx = annotx$Treatment,cfx=round(coefs,2),fdx=fdrs)
colnames(coefs)
#--------------------------------------
# load fitted models
#--------------------------------------
load('fit_linear_model.RData')
library(GuttmanHeatmap)
library(GuttmanHeatmap)
ls()
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
setwd("~/Library/CloudStorage/Dropbox/MountSinaiDermatology/GSK/statmodel/Clinical")
#--------------------
# load auxiliary files
#--------------------
source('label_map.R')
# read clinical data
d = read.xlsx('cc.xlsx')
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
min(mat)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
x = c(1.03,-1.23333,4.1)
x = c(0.09999,0.001,0.3,0.5)
p = c(1.23,-1.23,1.45,0.5)
dotab(x,p)
doTab(x,p)
doTab(x,p)
require(GuttmanHeatmap)
doTab(x,p)
dotab(x,p)
doTab(x,p)
x
p
doTab(matrix(x),matrix(p))
doTab(c(x),c(p))
FDR = matrix(c(0.04,0.03,0.02,0.001,0.5,0.1),ncol=2)
FDR
rownames(FDR) = c('A','B','C')
FDR = matrix(c(0.1,1.3,-1.2,1,-0.5,0.54),ncol=2)
FDR = matrix(c(0.04,0.03,0.02,0.001,0.5,0.1),ncol=2)
FCH = matrix(c(0.04,0.03,0.02,0.001,0.5,0.1),ncol=2)
rownames(FCH) = rownames(FDR)
FCH
FDR
rownames(FDR) = c('A','B','C')
FDR
rownames(FCH) = c('A','B','C')
FDR
doTab(FDR,FCH)
Tab = doTab(FDR,FCH)
Tab
colnames(FCH) =c('C1','C2')
colnames(FDR) =c('C1','C2')
Tab = doTab(FDR,FCH)
Tab
FCJ
FCH
FDR
FCH = matrix(c(0.1,1.3,-1.2,1,-0.5,0.54),ncol=2)
dimnames(FCH) = dimnames(FDR)
Tab = doTab(FDR,FCH)
Tab
FCH = matrix(c(0,1.3,-1.2,1,-0.5,0.54),ncol=2)
dimnames(FCH) = dimnames(FDR)
Tab = doTab(FDR,FCH)
Tab
FCH = matrix(c(0,1.3,-1.2,1,-0.5,0.54555555),ncol=2)
dimnames(FCH) = dimnames(FDR)
Tab = doTab(FDR,FCH)
Tab
FCH
rownames(FCH) = c('ABC','DE','F')
rownames(FDR) = c('ABC','DE','F')
Tab = doTab(FDR,FCH)
Tab
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
40*3200
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
library(GuttmanHeatmap)
file.edit('.Rprofile')
data(cars)
head(cars)
data(Boston)
head(Boston)
head(Boston)
dfx <- data.frame(
group = c(rep('A', 8), rep('B', 15), rep('C', 6)),
sex = sample(c("M", "F"), size = 29, replace = TRUE),
age = runif(n = 29, min = 18, max = 54)
)
dfx
summarySE(data = dfx,measurevar = 'Age',groupvars = c('group','sex'))
summarySE(data = dfx,measurevar = 'Age',groupvars = c('group','sex'),na.rm=F)
summarySE(data = dfx,measurevar = 'Age',groupvars = c('group','sex'),na.rm=TRUE)
dfx
summarySE(data = dfx,measurevar = age,groupvars = c(group,sex),na.rm=TRUE)
summarySE(data = dfx,measurevar = 'age' ,groupvars = c('group','sex'),na.rm=TRUE)
summarySE(data = dfx,measurevar = 'age' ,groupvars = c('group','sex'),na.rm=FALSE)
mat = cbind.data.frame(
gene1 = norm(3),
gene2 = norm(3),
gene3 = norm(3),
gene4 = norm(3),
gene5 = norm(3)
)
mat = cbind.data.frame(
gene1 = rnorm(3),
gene2 = rnorm(3),
gene3 = rnorm(3),
gene4 = rnorm(3),
gene5 = rnorm(3)
)
mat
mat= as.matrix(t(mat))
mat
mat = cbind.data.frame(
gene1 = rnorm(3),
gene2 = rnorm(3),
gene3 = rnorm(3),
gene4 = rnorm(3),
gene5 = rnorm(3)
)
mat= as.matrix(t(mat))
colnames(mat) = c('A','B','C')
mat = cbind.data.frame(
G1 = rnorm(3),
G2 = rnorm(3),
G3 = rnorm(3),
G4 = rnorm(3),
G5 = rnorm(3)
)
mat= as.matrix(t(mat))
colnames(mat) = c('A','B','C')
lgfch.matrix = cbind.data.frame(
AvsB = runif(3,-2,2),
AvsC = runif(3,-2,2),
BvsC = runif(3,-2,2)
)
fdr.matrix = cbind.data.frame(
AvsB = runif(3,0,1),
AvsC = runif(3,0,1),
BvsC = runif(3,0,1)
)
rownames(lgfch.matrix) = c('G1','G2','G3','G4','G5')
rownames(fdr.matrix) = rownames(lgfch.matrix)
minimal<-function(){
mat = cbind.data.frame(
G1 = rnorm(3),
G2 = rnorm(3),
G3 = rnorm(3),
G4 = rnorm(3),
G5 = rnorm(3)
)
mat= as.matrix(t(mat))
colnames(mat) = c('A','B','C')
annot = cbind.data.frame(
Group = c('A','B','C')
)
row.names(annot) = c('A','B','C')
lgfch.matrix = cbind.data.frame(
AvsB = runif(3,-2,2),
AvsC = runif(3,-2,2),
BvsC = runif(3,-2,2)
) %>% as.matrix()
fdr.matrix = cbind.data.frame(
AvsB = runif(3,0,1),
AvsC = runif(3,0,1),
BvsC = runif(3,0,1)
) %>% as.matrix()
rownames(lgfch.matrix) = c('G1','G2','G3','G4','G5')
rownames(fdr.matrix) = rownames(lgfch.matrix)
return(list(mat,lgfch.matrix,fdr.matrix,annot))
}
minimal()
minimal<-function(){
require(tidyverse)
mat = cbind.data.frame(
G1 = rnorm(3),
G2 = rnorm(3),
G3 = rnorm(3),
G4 = rnorm(3),
G5 = rnorm(3)
)
mat= as.matrix(t(mat))
colnames(mat) = c('A','B','C')
annot = cbind.data.frame(
Group = c('A','B','C')
)
row.names(annot) = c('A','B','C')
lgfch.matrix = cbind.data.frame(
AvsB = runif(3,-2,2),
AvsC = runif(3,-2,2),
BvsC = runif(3,-2,2)
) %>% as.matrix()
fdr.matrix = cbind.data.frame(
AvsB = runif(3,0,1),
AvsC = runif(3,0,1),
BvsC = runif(3,0,1)
) %>% as.matrix()
rownames(lgfch.matrix) = c('G1','G2','G3','G4','G5')
rownames(fdr.matrix) = rownames(lgfch.matrix)
return(list(mat,lgfch.matrix,fdr.matrix,annot))
}
minimal()
mat = cbind.data.frame(
G1 = rnorm(3),
G2 = rnorm(3),
G3 = rnorm(3),
G4 = rnorm(3),
G5 = rnorm(3)
)
mat= as.matrix(t(mat))
colnames(mat) = c('A','B','C')
annot = cbind.data.frame(
Group = c('A','B','C')
)
row.names(annot) = c('A','B','C')
lgfch.matrix = cbind.data.frame(
AvsB = runif(3,-2,2),
AvsC = runif(3,-2,2),
BvsC = runif(3,-2,2)
) %>% as.matrix()
fdr.matrix = cbind.data.frame(
AvsB = runif(3,0,1),
AvsC = runif(3,0,1),
BvsC = runif(3,0,1)
) %>% as.matrix()
minimal<-function(){
require(tidyverse)
mat = cbind.data.frame(
G1 = rnorm(3),
G2 = rnorm(3),
G3 = rnorm(3),
G4 = rnorm(3),
G5 = rnorm(3)
)
mat= as.matrix(t(mat))
colnames(mat) = c('A','B','C')
annot = cbind.data.frame(
Group = c('A','B','C')
)
row.names(annot) = c('A','B','C')
lgfch.matrix = cbind.data.frame(
AvsB = runif(5,-2,2),
AvsC = runif(5,-2,2),
BvsC = runif(5,-2,2)
) %>% as.matrix()
fdr.matrix = cbind.data.frame(
AvsB = runif(5,0,1),
AvsC = runif(5,0,1),
BvsC = runif(5,0,1)
) %>% as.matrix()
rownames(lgfch.matrix) = c('G1','G2','G3','G4','G5')
rownames(fdr.matrix) = rownames(lgfch.matrix)
return(list(mat,lgfch.matrix,fdr.matrix,annot))
}
minimal()
minimal<-function(){
require(tidyverse)
mat = cbind.data.frame(
G1 = rnorm(3),
G2 = rnorm(3),
G3 = rnorm(3),
G4 = rnorm(3),
G5 = rnorm(3)
)
mat= as.matrix(t(mat))
colnames(mat) = c('A','B','C')
annot = cbind.data.frame(
Group = c('A','B','C')
)
row.names(annot) = c('A','B','C')
lgfch.matrix = cbind.data.frame(
AvsB = runif(5,-2,2),
AvsC = runif(5,-2,2),
BvsC = runif(5,-2,2)
) %>% as.matrix()
fdr.matrix = cbind.data.frame(
AvsB = runif(5,0,1),
AvsC = runif(5,0,1),
BvsC = runif(5,0,1)
) %>% as.matrix()
rownames(lgfch.matrix) = c('G1','G2','G3','G4','G5')
rownames(fdr.matrix) = rownames(lgfch.matrix)
return(list(mat = mat, lgfch = lgfch.matrix, fdr = fdr.matrix, annot = annot))
}
doAnnotatedHeatmap <-function(
grafname, # grafname
matx, # matrix of expression
annot.col, # annotation data
colsplitx=NULL, # splitting column
column_ha = NULL,
BigTab = NULL,
wdt=NULL, # width
hgt=NULL, # height
setname='', # description of the gene set
column_names_max_height = unit(8, "cm"),
BigTabcols=NULL,
cfx = NULL, # lgfch of contrasts of interest
fdx  = NULL, # fdr or pvalue for the contrasts of interest
ShowColumnNames = F,
fnt_size_title = 20,
scalerows=TRUE,
rampvalues = 1.5,
...
#tabNames = NULL # example of 3 contrasts,...
){
if (!is.null(BigTabcols)){
allBigTabcols<-c()
for (i in BigTabcols){
allBigTabcols<-append(allBigTabcols,colnames(BigTab)[str_detect(colnames(BigTab),i)])
}
BigTab<-BigTab[allBigTabcols]
}
#cfxfunc<-function(x){substr(x,1,5)=='lgFCH'}
#fdxfunc<-function(x){substr(x,1,5)=='pvals'}
#cfx=BigTab[,colnames(BigTab)[unlist(lapply(colnames(BigTab),cfxfunc))]]
#fdx=BigTab[,colnames(BigTab)[unlist(lapply(colnames(BigTab),fdxfunc))]]
ncontrasts = dim(cfx)[2]
# number of genes
n.genes = dim(matx)[1]
if (is.null(wdt)){wdt=dim(matx)[2]*2+dim(BigTab)[2]/10}
if (is.null(hgt)){hgt=max(8,n.genes/4)}
mat = matx[,rownames(annot.col)]
scale_rows<-function (x)
{
m = apply(x, 1, mean, na.rm = T)
s = apply(x, 1, sd , na.rm = T)
return((x - m)/s)
}
if(scalerows == TRUE){
mat=scale_rows(mat)}else if(scalerows == FALSE)
{
mat = mat
}
if(!is.null(cfx)){
Tab = doTab(fdrsx = fdx , coefsx = cfx)
}else{
Tab = cbind.data.frame(Gene = rownames(matx))
}
require(circlize)
require(ComplexHeatmap)
col_fun = colorRamp2(c(-1*rampvalues,0,rampvalues), c("blue",'white', "red"),space= 'sRGB')
scalename = 'Z-score'
if(scalerows==FALSE){
col_fun = colorRamp2(c(min(mat)+1,mean(mat),max(mat)-1), c("blue",'white', "red"),space= 'sRGB')
scalename =  'log2-expression'
}
row_dend = as.dendrogram(hclust(dist(mat)))
ht = ComplexHeatmap::Heatmap(mat,
name = scalename,
# row_km = 3,
column_split = colsplitx ,
column_title_gp = gpar(fontsize =fnt_size_title),
col = col_fun,
top_annotation = column_ha ,
cluster_rows = T,
cluster_columns = F,
show_row_names = F,
show_column_names = ShowColumnNames,
column_order = (rownames(annot.col)),
use_raster = TRUE)
ha_names = rowAnnotation(Gene = anno_text(gt_render(Tab[,1], align_widths = TRUE),location=0,just='left' ,
gp = gpar(fill ='white', border= 'white', col = "black", fontface = 2,  fontsize = 12,
fontfamily = "mono")))
htlist=ht+ha_names
if(!is.null(cfx)){
for (i in 1:ncontrasts){
thisha=rowAnnotation( x=anno_text( gt_render((Tab[,i+1]), align_widths = FALSE),
gp = gpar(box_col = "black", box_lwd =1, fontface=2, fontsize = 12,
fontfamily = "mono"),
just = "left",show_name = FALSE))
names(thisha)<-paste('Tab',i,sep='')
htlist=htlist+thisha
}
}
# write the file to a pdf file
pdf(file = grafname,width=wdt,height=hgt)
draw(htlist,padding = unit(c(8, 8, 12, 12), "mm") ,  column_title = setname ,column_title_side = 'bottom')
if(!is.null(cfx)){
for (i in 1:ncontrasts){
nm=paste('Tab',i,sep='')
decorate_annotation(nm, {
grid.text(gsub('\\.','\n',substring(colnames(Tab)[i+1],7)), y = unit(1, "npc") + unit(2, "mm"), just = "bottom",hjust =0,rot=0,
gp = gpar(box_col = "black", box_lwd =1, fontface=2,fontsize=10,fontfamily='mono'))
})
}
}
dev.off()
}
require(GuttmanHeatmap)
FancyAnnotatedHeatmap()
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr)
names(thisha)<-paste('Tab',i,sep='')
htlist=htlist+thisha
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,width=6,height=4)
minimal()$mat
minimal()$lgfch
minimal()$fdr
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,width=6,height=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdx=6,hgx=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=4)
446/38
help(gt_render)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=4)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=3.5,hgt=2.5)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=2.5)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=2.5)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=2.5)
FancyAnnotatedHeatmap(matx = minimal()$mat , grafname = 'teste.pdf' , annot.col = minimal()$annot,cfx=minimal()$lgfch,fdx = minimal()$fdr,wdt=6,hgt=2.5)
